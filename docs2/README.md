# Anomaly-Aware Knowledge Tracing v2

åŸºäºDTransformerçš„å¼‚å¸¸æ„ŸçŸ¥çŸ¥è¯†è¿½è¸ªé¡¹ç›®é‡æ„ç‰ˆæœ¬

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨é€šè¿‡å¼‚å¸¸æ£€æµ‹æŠ€æœ¯å¢å¼ºçŸ¥è¯†è¿½è¸ªæ¨¡å‹çš„æ€§èƒ½ã€‚é¡¹ç›®åˆ†ä¸ºå››ä¸ªä¸»è¦é˜¶æ®µï¼š

1. **Stage 1: åŸºçº¿æ¨¡å‹è®­ç»ƒ** - è®­ç»ƒæ ‡å‡†DTransformerçŸ¥è¯†è¿½è¸ªæ¨¡å‹
2. **Stage 2: å¼‚å¸¸åˆ†ç±»å™¨è®­ç»ƒ** - è®­ç»ƒå¼‚å¸¸æ£€æµ‹å™¨è¯†åˆ«å­¦ä¹ è¡Œä¸ºå¼‚å¸¸
3. **Stage 3: å¼‚å¸¸æ„ŸçŸ¥çŸ¥è¯†è¿½è¸ª** - è®­ç»ƒèåˆå¼‚å¸¸ä¿¡æ¯çš„çŸ¥è¯†è¿½è¸ªæ¨¡å‹
4. **Stage 4: æ€§èƒ½è¯„ä¼°ä¸å¯¹æ¯”** - è¯„ä¼°å¼‚å¸¸æ„ŸçŸ¥æ¨¡å‹ç›¸å¯¹äºåŸºçº¿çš„æå‡

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
anomaly_kt_v2/
â”œâ”€â”€ __init__.py                 # é¡¹ç›®åˆå§‹åŒ–
â”œâ”€â”€ configs/                    # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py            # é…ç½®ç®¡ç†æ¨¡å—
â”‚   â””â”€â”€ assist17_baseline.yaml # ASSIST17åŸºçº¿é…ç½®
â”œâ”€â”€ core/                      # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py           # æ ¸å¿ƒæ¨¡å—å¯¼å‡º
â”‚   â””â”€â”€ common.py             # é€šç”¨å·¥å…·å‡½æ•°
â”œâ”€â”€ stages/                   # è®­ç»ƒé˜¶æ®µ
â”‚   â”œâ”€â”€ __init__.py          # é˜¶æ®µæ¨¡å—å¯¼å‡º
â”‚   â””â”€â”€ stage1_baseline.py   # ç¬¬ä¸€é˜¶æ®µï¼šåŸºçº¿è®­ç»ƒ
â””â”€â”€ scripts/                 # è®­ç»ƒè„šæœ¬
    â”œâ”€â”€ __init__.py         # è„šæœ¬æ¨¡å—
    â””â”€â”€ run_stage1_baseline.py # ç¬¬ä¸€é˜¶æ®µè®­ç»ƒè„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- PyTorch 1.9+
- CUDA (æ¨è)

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…åŸºç¡€ä¾èµ–
pip install torch torchvision torchaudio
pip install numpy pandas scikit-learn
pip install pyyaml tomlkit tqdm

# ç¡®ä¿DTransformeré¡¹ç›®åœ¨åŒçº§ç›®å½•
```

### é‡è¦è¯´æ˜

âš ï¸ **ä¾èµ–å…³ç³»**: æœ¬é¡¹ç›®å®Œå…¨åŸºäºåŸå§‹çš„DTransformerä»£ç ï¼Œä¸ä¾èµ–ä»»ä½•`anomaly_kt`æ¨¡å—ã€‚æ‰€æœ‰è®­ç»ƒé€»è¾‘éƒ½ç›´æ¥ä½¿ç”¨DTransformerçš„åŸç”Ÿå®ç°ã€‚

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºçº¿æ¨¡å‹è®­ç»ƒ

#### åŸºç¡€æ¨¡å‹è®­ç»ƒï¼ˆæ¨èå¼€å§‹ï¼‰

```bash
# åŸºç¡€æ¨¡å‹ï¼šd_model=128, n_heads=8, å‚æ•°é‡~1.2M
python scripts/run_stage1_baseline.py \
    --dataset assist17 \
    --model_type basic \
    --auto_config \
    --device cuda
```

#### æ‰©å±•æ¨¡å‹è®­ç»ƒï¼ˆè¿½æ±‚æ›´é«˜æ€§èƒ½ï¼‰

```bash
# æ‰©å±•æ¨¡å‹ï¼šd_model=256, n_heads=16, å‚æ•°é‡~4.8M
python scripts/run_stage1_baseline.py \
    --dataset assist17 \
    --model_type extended \
    --auto_config \
    --device cuda
```

#### ä½¿ç”¨è‡ªå®šä¹‰é…ç½®

```bash
python scripts/run_stage1_baseline.py \
    --dataset assist17 \
    --model_type basic \
    --config configs/assist17_baseline.yaml \
    --device cuda
```

#### å®Œå…¨è‡ªå®šä¹‰å‚æ•°

```bash
python scripts/run_stage1_baseline.py \
    --dataset assist17 \
    --model_type basic \
    --d_model 256 \
    --n_heads 16 \
    --n_layers 3 \
    --kt_epochs 100 \
    --learning_rate 0.001 \
    --device cuda
```

## ğŸ”„ æ¨¡å‹ç±»å‹å¯¹æ¯”

### åŸºç¡€æ¨¡å‹ vs æ‰©å±•æ¨¡å‹

| ç‰¹æ€§ | åŸºç¡€æ¨¡å‹ (basic) | æ‰©å±•æ¨¡å‹ (extended) |
|------|------------------|---------------------|
| **æ¨¡å‹ç»´åº¦** | d_model=128, n_heads=8 | d_model=256, n_heads=16 |
| **å‚æ•°é‡** | ~1.2M | ~4.8M |
| **è®­ç»ƒæ—¶é—´** | 30-45åˆ†é’Ÿ | 60-90åˆ†é’Ÿ |
| **GPUå†…å­˜** | è¾ƒå°‘ | è¾ƒå¤š |
| **é¢„æœŸAUC** | 0.74-0.76 | 0.76-0.78 |
| **é€‚ç”¨åœºæ™¯** | å¿«é€ŸéªŒè¯ã€èµ„æºå—é™ | è¿½æ±‚æœ€ä½³æ€§èƒ½ |

### é€‰æ‹©å»ºè®®

- **ğŸš€ å¿«é€Ÿå¼€å§‹**: ä½¿ç”¨åŸºç¡€æ¨¡å‹éªŒè¯æµç¨‹
- **ğŸ“ˆ æ€§èƒ½å¯¹æ¯”**: è®­ç»ƒä¸¤ç§æ¨¡å‹è¿›è¡Œå¯¹æ¯”
- **ğŸ’° èµ„æºå—é™**: é€‰æ‹©åŸºç¡€æ¨¡å‹
- **ğŸ¯ è¿½æ±‚æè‡´**: é€‰æ‹©æ‰©å±•æ¨¡å‹

## ğŸ“Š æ”¯æŒçš„æ•°æ®é›†

- **ASSIST09**: å°è§„æ¨¡æ•°æ®é›†ï¼Œé€‚åˆå¿«é€Ÿå®éªŒ
- **ASSIST17**: å¤§è§„æ¨¡æ•°æ®é›†ï¼Œæ¨èç”¨äºå®Œæ•´å®éªŒ
- **Algebra05**: ä»£æ•°å­¦ä¹ æ•°æ®é›†
- **Statics**: é™åŠ›å­¦æ•°æ®é›†

## âš™ï¸ é…ç½®ç³»ç»Ÿ

### é…ç½®æ–‡ä»¶æ ¼å¼

é…ç½®æ–‡ä»¶ä½¿ç”¨YAMLæ ¼å¼ï¼Œæ”¯æŒä»¥ä¸‹å‚æ•°ç±»åˆ«ï¼š

```yaml
# åŸºæœ¬å‚æ•°
dataset: assist17
device: cuda
with_pid: true

# æ•°æ®å‚æ•°
batch_size: 16
test_batch_size: 32

# æ¨¡å‹å‚æ•°
d_model: 128
n_heads: 8
n_layers: 3
dropout: 0.2

# è®­ç»ƒå‚æ•°
kt_epochs: 100
learning_rate: 0.001
patience: 10
```

### å‚æ•°ä¼˜å…ˆçº§

1. **å‘½ä»¤è¡Œå‚æ•°** (æœ€é«˜ä¼˜å…ˆçº§)
2. **é…ç½®æ–‡ä»¶å‚æ•°**
3. **é»˜è®¤å€¼** (æœ€ä½ä¼˜å…ˆçº§)

## ğŸ“ˆ è®­ç»ƒç›‘æ§

### è¾“å‡ºç›®å½•ç»“æ„

```
output/stage1_assist17_20240101_120000/
â”œâ”€â”€ config.yaml              # ä¿å­˜çš„è®­ç»ƒé…ç½®
â”œâ”€â”€ baseline/                 # åŸºçº¿æ¨¡å‹ç›®å½•
â”‚   â”œâ”€â”€ best_model.pt        # æœ€ä½³æ¨¡å‹æƒé‡
â”‚   â”œâ”€â”€ training_log.txt     # è®­ç»ƒæ—¥å¿—
â”‚   â””â”€â”€ metrics.json         # è®­ç»ƒæŒ‡æ ‡
â””â”€â”€ plots/                   # è®­ç»ƒæ›²çº¿å›¾
    â”œâ”€â”€ loss_curve.png
    â””â”€â”€ auc_curve.png
```

### å…³é”®æŒ‡æ ‡

- **AUC**: çŸ¥è¯†è¿½è¸ªçš„ä¸»è¦è¯„ä¼°æŒ‡æ ‡
- **ACC**: é¢„æµ‹å‡†ç¡®ç‡
- **Loss**: è®­ç»ƒæŸå¤±
- **Early Stopping**: åŸºäºéªŒè¯é›†AUCçš„æ—©åœæœºåˆ¶

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æ•°æ®é›†

1. åœ¨`data/datasets.toml`ä¸­æ·»åŠ æ•°æ®é›†é…ç½®
2. åˆ›å»ºå¯¹åº”çš„é…ç½®æ–‡ä»¶`configs/{dataset}_baseline.yaml`
3. åœ¨è„šæœ¬ä¸­æ·»åŠ æ•°æ®é›†é€‰é¡¹

### è‡ªå®šä¹‰æ¨¡å‹å‚æ•°

ä¿®æ”¹é…ç½®æ–‡ä»¶æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°è¦†ç›–é»˜è®¤è®¾ç½®ï¼š

```bash
# å¢åŠ æ¨¡å‹å®¹é‡
python scripts/run_stage1_baseline.py \
    --dataset assist17 \
    --d_model 512 \
    --n_heads 16 \
    --n_layers 6 \
    --device cuda
```

### è°ƒè¯•æ¨¡å¼

```bash
# ä½¿ç”¨å°æ‰¹æ¬¡å¿«é€Ÿè°ƒè¯•
python scripts/run_stage1_baseline.py \
    --dataset assist17 \
    --batch_size 4 \
    --kt_epochs 5 \
    --device cpu
```

## ğŸ“ å®éªŒè®°å½•

### æ¨èçš„å®éªŒæµç¨‹

1. **åŸºçº¿å®éªŒ**: ä½¿ç”¨é»˜è®¤é…ç½®å»ºç«‹æ€§èƒ½åŸºçº¿
2. **å‚æ•°è°ƒä¼˜**: ç³»ç»Ÿæ€§è°ƒæ•´å…³é”®å‚æ•°
3. **æ¶ˆèç ”ç©¶**: éªŒè¯å„ç»„ä»¶çš„è´¡çŒ®
4. **æœ€ç»ˆè¯„ä¼°**: åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æœ€ä½³é…ç½®

### å®éªŒé…ç½®ç¤ºä¾‹

```yaml
# ä¿å®ˆé…ç½®ï¼ˆå¿«é€ŸéªŒè¯ï¼‰
d_model: 128
n_heads: 8
kt_epochs: 50

# æ ‡å‡†é…ç½®ï¼ˆå¹³è¡¡æ€§èƒ½ï¼‰
d_model: 256
n_heads: 16
kt_epochs: 100

# é«˜æ€§èƒ½é…ç½®ï¼ˆè¿½æ±‚æœ€ä½³æ•ˆæœï¼‰
d_model: 512
n_heads: 16
kt_epochs: 200
```

## ğŸ› å¸¸è§é—®é¢˜

### CUDAå†…å­˜ä¸è¶³

```bash
# å‡å°‘æ‰¹æ¬¡å¤§å°
--batch_size 8 --test_batch_size 16

# æˆ–ä½¿ç”¨CPU
--device cpu
```

### è®­ç»ƒæ”¶æ•›æ…¢

```bash
# è°ƒæ•´å­¦ä¹ ç‡
--learning_rate 0.005

# å¢åŠ æ¨¡å‹å®¹é‡
--d_model 256 --n_heads 16
```

### é…ç½®æ–‡ä»¶æœªæ‰¾åˆ°

ç¡®ä¿é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼Œæˆ–ä½¿ç”¨`--auto_config`è‡ªåŠ¨æ£€æµ‹ã€‚

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. DTransformer: åŸå§‹çŸ¥è¯†è¿½è¸ªæ¨¡å‹
2. Anomaly Detection in Educational Data Mining
3. Contrastive Learning for Knowledge Tracing

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ·Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦è§LICENSEæ–‡ä»¶ã€‚
